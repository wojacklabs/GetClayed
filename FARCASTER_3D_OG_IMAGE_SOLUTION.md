# Farcaster 3D OG 이미지 솔루션

## 문제
Farcaster에서 프로젝트 링크 공유 시 3D 모델 대신 기본 OG 이미지(clay ball)만 표시됨

## 해결 방법

### 1. 프로젝트 OG 이미지 생성 로직 개선 (`/api/og/project/[id]/route.tsx`)

3단계 폴백 시스템 구현:

1. **썸네일 우선 사용**
   - URL 파라미터의 `thumbnailId` 확인
   - 프로젝트 데이터에서 `thumbnailId` 확인
   - 썸네일이 있으면 직접 반환

2. **3D 객체 SVG 렌더링**
   - 프로젝트의 `clayObjects` 데이터 로드
   - 각 객체를 간단한 2D SVG 형태로 변환
   - 위치, 크기, 색상, 타입 반영
   - 프로젝트명과 작가 정보 오버레이

3. **스타일된 폴백 이미지**
   - 3D 데이터가 없을 때 사용
   - 프로젝트명과 작가 정보 표시
   - 세련된 그라데이션 배경

### 2. 구현 세부사항

```typescript
// 3D 객체 타입별 SVG 렌더링
switch(obj.type) {
  case 'box':
    // 사각형으로 표현
  case 'cylinder':
    // 타원으로 표현
  default: // sphere, cone, torus
    // 원으로 표현
}
```

- 최대 10개 객체까지 렌더링
- Z축 위치로 불투명도 조정 (깊이감 표현)
- 회전값 적용 (Z축 회전만)
- 실제 색상 반영

### 3. 장점

1. **서버리스 환경 호환**
   - Puppeteer 불필요
   - Edge Runtime에서 작동
   - 빠른 응답 속도

2. **점진적 개선**
   - 썸네일이 있는 프로젝트는 고품질 이미지
   - 없어도 실제 3D 데이터 기반 프리뷰
   - 최악의 경우에도 깔끔한 폴백

3. **성능**
   - 캐싱 헤더 설정 (1시간)
   - 가벼운 SVG 렌더링
   - 비동기 데이터 로드

## 테스트 방법

1. **로컬 테스트**
   ```bash
   npm run dev
   # 브라우저에서 확인:
   # http://localhost:3000/api/og/project/[PROJECT_ID]
   ```

2. **Farcaster 테스트**
   - Warpcast에서 프로젝트 링크 공유
   - 프리뷰 확인

3. **디버깅**
   - 프로젝트 데이터 확인: `https://uploader.irys.xyz/tx/[ID]/data`
   - OG 이미지 직접 확인: `https://getclayed.io/api/og/project/[ID]`

## 향후 개선사항

1. **프로젝트 저장 시 썸네일 자동 생성**
   - 클라이언트에서 3D 캔버스 스크린샷
   - Irys에 썸네일 업로드
   - 프로젝트 데이터에 `thumbnailId` 포함

2. **더 정교한 2D 표현**
   - 3D 투영 매트릭스 적용
   - 그림자 효과
   - 더 많은 객체 타입 지원

3. **백그라운드 썸네일 생성 서비스**
   - 기존 프로젝트들의 썸네일 일괄 생성
   - 주기적 업데이트

## 현재 상태

✅ 도메인 마이그레이션 완료 (`getclayed.io`)
✅ OG 이미지 생성 로직 개선
✅ 3단계 폴백 시스템 구현
✅ 빌드 성공

⚠️ 대부분의 기존 프로젝트는 썸네일이 없음
⚠️ 복잡한 3D 모델은 단순화되어 표현됨

## 결론

Farcaster 프리뷰에서 실제 3D 프로젝트 내용을 보여줄 수 있도록 개선되었습니다. 
썸네일이 없는 프로젝트도 실제 3D 데이터를 기반으로 프리뷰가 생성됩니다.
